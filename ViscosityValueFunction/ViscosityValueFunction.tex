
\chapter{Continuous value functions}

	\section{Generalizing the total derivative}
	
	The example from section \ref{non-smooth} shows that it is impractical to assume the smoothness of the value function. We therefore extract the essential properties of its classical total derivative, used to derive the HJB-equation \ref{HJB} and the subsequent comparison results in the smooth case. Lemma \ref{extension lemma}, the key to our previous comparison and uniqueness results, proves itself particularly helpful in our quest.
	
	Given a smooth subsolution $ w $ of
	
	\begin{equation}
		\label{general diff}
		F(t, x, w, Dw) \leq 0 \ ,
	\end{equation}
	
	the proof of lemma \ref{extension lemma} was based on the fact, that for every smooth function $ \varphi $, the inequality 
	
	\begin{equation*}
		F(t_0, x_0, w(x_0, x_0), D\varphi(t_0, x_0)) \leq 0
	\end{equation*}
	
	is satisfied, whenever $ w - \varphi $ attains an interior local maximum in $ (t_0, x_0) $. That is, we can replace the classical total derivative of $ w $ in \ref{general diff}, by the derivative of $ \varphi $, in local maxima of $ w - \varphi $. In view of this observation, the following generalization seems sensible.
	
	\begin{definition}
		Let $ \Omega \subset \mathbb{R}^N $ be an open domain. A real-valued continuous function $ u : \Omega \to \mathbb{R} $ is called a \emph{viscosity subsolution} of $ F : \Omega \times \mathbb{R} \times \mathbb{R}^N \to \mathbb{R} $, if for any smooth function $ \varphi \in C^1(\Omega) $, we have that
		
		\begin{equation}
			\label{def viscosity subsolution}
			F(x_0, u(x_0), D \varphi(x_0)) \leq 0 \ ,
		\end{equation}
		whenever $ u - \varphi $ attains a local \emph{maximum} in $ x_0 \in \Omega $.
		
		We respectively call $ u $ a \emph{viscosity supersolution} of $ F $, if
		
		\begin{equation}
			\label{def viscosity supersolution}
			F(x_0, u(x_0), D\varphi(x_0)) \geq 0
		\end{equation}
		whenever $ u - \varphi $ attains local \emph{minimum} in $ x_0 \in \Omega $. 
		
		We finally call $ u $ a \emph{viscosity solution} of $ F $, if it is a viscosity sub-and supersolution of $ F $.
	\end{definition}

	For convenience, we give an additional definition to denote the sets of differentials, generated by such smooth test functions.
	
	\begin{definition}
		Let $ \Omega \subset \mathbb{R}^N $ be an open domain and $ u : \Omega \to \mathbb{R} $ a real-valued, continuous function. Consider a point $ x_0 \in \Omega $. 
		
		A vector $ p \in \mathbb{R}^N $ is termed a \emph{superdifferential} of $ u $ in $ x_0 $, if there exists a smooth function $ \varphi \in C^{1}(\Omega) $, s.t. $ u - \varphi $ attains a local \emph{maxmium} in $ x_0 $, and $ p = D \varphi(x_0) $. The set of all superdifferentials is denote by $ D^{+}u(x_0) $ .
		
		Analogously, a vector $ p \in \mathbb{R}^N $ is termed a \emph{subdifferential} of $ u $ in $ x_0 $, if there exists a smooth function $ \varphi \in C^{1}(\Omega) $, s.t. $ u - \varphi $ attains a local \emph{minimum} in $ x_0 $, and $ p = D \varphi(x_0) $. The set of all subdifferentials is denote by $ D^{-}u(x_0) $.
	\end{definition}

	Of course the notion of viscosity solution is only of interest, if the value function is a viscosity solution of \ref{HJB}.
	
	\begin{theorem}
		\label{viscosity solution HJB}
		Suppose the same assumptions as in theorem \ref{classical solution HJB}, except for the smoothness of the value function $ v $, hold. Then $ v $ is a viscosity solution of \ref{HJB}.
		
		\begin{proof}
			The proof of theorem \ref{classical solution HJB} only requires minor modifications.
			
			We have already stated that $ v $ is known to be locally Lipschitz-continuous, and consequently continuous, under the given assumptions.
			
			In order to show that $ v $ is a viscosity subsolution of \ref{HJB}, note that
			
			\begin{equation*}
				\varphi(t, x) - \varphi(t_0, x_0) \geq v(t, x) - v(t_0, x_0) \ ,
			\end{equation*}
			
			in a sufficiently small neighbourhood of $ (t_0, x_0) $, whenever $ v - \varphi $ attains a local maximum in $ (t_0, x_0) $.
			The left-hand-side of \ref{diff_quotient_sub}, can therefore be replaced by
			
			\begin{equation*}
				\frac{\varphi(t_0 + h, x^{\overline{a}}_{x_0}(t_0 + h)) - \varphi(t_0, x_0)}{h} \ .
			\end{equation*}
			Now proceed as in theorem \ref{classical solution HJB} to show that $ v $ is viscosity subsolution of \ref{HJB}.
			
			We proceed in a similar manner when proving $ v $ a supersolution of \ref{HJB}. However, an additional technical detail has to be taken into account. Recall the proof of $ v $ being a supersolution, when smooth. There we have considered a whole family of trajectories $ x_{x_0}^{\alpha} $, all satisfying the same initial condition $ x(t_0) = x_0 $, w.r.t. to different controls $ \alpha = \alpha(h) $. Once again we seek to replace the left-hand side of \eqref{diff_quotient_super}, by

			\begin{equation*}
				\frac{\varphi(t_0 + h, x^{\alpha}_{x_0}(t_0 + h)) - \varphi(t_0, x_0)}{h} \ ,
			\end{equation*}
			using the fact that $ v - \phi $ attains a local minimum in $ (t_0, x_0) $.
			But as $ (t_0, x_0) $ is only known to be a \emph{local} minimum, the substitution only works if $ x^{\alpha}_{x_0}(t_0 + h) $ is close enough to $ x_0 $. We therefore need the equicontinuity of all trajectories $ x^{\alpha}_{x_0} $ in $ t_0 $. But in view of \eqref{trajectory equicontinuous}, this is clearly the case.
		\end{proof}
	\end{theorem}

	Up to now, the notion of viscosity solutions, first introduced in \cite{lions} by M.G. Crandall and P.L. Lions, seems to fit our needs. Of course we still have to check whether the comparison and uniqueness results proven in the smooth case still remain valid, if replaced by viscosity solutions.
	
	\section{From classical solutions to viscosity solutions}
	Our goal is to transfer the results proven for classical solutions, namely lemma \ref{extension lemma}, theorem \ref{smooth_loc} and corollary \ref{Smooth Uniqueness} to viscosity solutions. We start with lemma \ref{extension lemma}.
	
	\begin{lemma}
		\label{extension lemma viscosity}
		Let $ \Omega^{\prime} \subset \mathbb{R}^{N-1} $ be an open domain. Set $ \Omega \coloneqq \left( a, b \right) \times \Omega^{\prime} $. Suppose $ w \in C (\overline{\Omega})$ is a subsolution of
		
		\begin{equation*}
		F(t, x, w, Dw) = 0
		\end{equation*}
		in $ \Omega $, where $ F : \left[ a, b \right) \times \Omega^{\prime} \times \mathbb{R} \times \mathbb{R}^{N} \to \mathbb{R} $ is a continuous function, and the mapping
		
		\begin{equation*}
		s \mapsto F(t, x, r, s, p_1, \ldots, p_{N-1})
		\end{equation*}
		is non-increasing for every $ (t, x, r, p_1, \ldots, p_{N-1}) $. Let $ \varphi \in C^{1} \left( \Omega \right) $, s.t. its total differential continuously extends to $ \left[a, b\right) \times \Omega^{\prime} $.
		
		If $ w - \varphi $ attains a local maximum in some point $ \overlinedPair{t}{x} \in \left[a, b\right) \times \Omega^{\prime} $, then
		
		\begin{equation*}
		F(\overline{t}, \overline{x}, w\overlinedPair{t}{x}, D\varphi\overlinedPair{t}{x})) \leq 0.
		\end{equation*}
		
		\begin{proof}
			The claim holds immediately for interior extrema by the definition of viscosity subsolutions, which replaces the use of Fermat's rule in the smooth case. For boundary points, proceed exactly as for smooth subsolutions.
		\end{proof}
	\end{lemma}

	Now for theorem \ref{smooth_loc}. The proof given consisted of exactly two steps: firstly showing that the difference $ w $ is a subsolution to equation \ref{diff-PDE}, namely
	
	\begin{equation*}
		-w_t - C \lvert D_x w \rvert \leq 0 \ ,
	\end{equation*}
	
	and secondly comparing $ w $ to some supersolutions of the same equation. Latter step simply relies on lemma \ref{extension lemma} which has already been further generalized to continuous viscosity subsolutions in lemma \ref{extension lemma viscosity}. In contrast, the generalization of the first step proves itself trickier. 

	\subsection{A naive approach}
		\label{naive}
		
		We want to deduce that $ w \coloneqq u - v $ is a viscosity subsolution of \ref{diff-PDE}, provided that $ u $ and $ v $ are respectively viscosity sub-and supersolutions of
		
		\begin{equation*}
				-u_t + H(t, x, -D_x u) = 0 \ .
		\end{equation*}
		
		For this purpose, suppose we are given an arbitrary subdifferential in some point $ (t_0, x_0) $. We could naively try to decompose this subdifferential of $ w $ as the difference of a subdifferential of $ u $ and a superdifferential of $ v $ in the \emph{same} point $ (t_0, x_0) $, and proceed exactly as in the smooth case. This approach reveals itself being too optimistic, as we consider the continuous function
		
		\begin{align*}
			f : \mathbb{R} &\to \mathbb{R} \\
			r &\mapsto \begin{cases}
			\lvert r \rvert^{1/2} \sin(\frac{1}{r^2}), &\hbox{ if } r \neq 0 \\
			0 &\hbox{ if } r = 0  \ ,
			\end{cases}
		\end{align*}
		
		taken from \cite[p.~32, exercise 1.5]{bardi2008optimal}. Suppose for the sake of contradiction, that $ Df^{+}(0) $ was not empty. Then there exists a function $ \varphi \in C^1(\mathbb{R}) $, such that $ f - \varphi $ attains a local maximum in zero, i.e
		
		\begin{equation*}
			f(0) - f(0 + h) \geq \varphi(0) - \varphi(0 + h) 
		\end{equation*}
		for small $ h $. For strictly positive $ h $, we additionally get
		
		\begin{equation*}
			\frac{f( 0 + h) - f(0)}{h} \leq \frac{\varphi(0 + h) - \varphi(0)}{h} \ ,
		\end{equation*}
		
		and consequently 
		
		\begin{equation*}
			\limsup\limits_{h \searrow 0} \frac{f( 0 + h) - f(0)}{h} \leq \limsup\limits_{h \searrow 0} \frac{\varphi(0 + h) - \varphi(0)}{h} \ .
		\end{equation*}
		
		But 
		
		\begin{equation*}
			\limsup\limits_{h \searrow 0} \frac{f( 0 + h) - f(0)}{h} = \infty \ ,
		\end{equation*}
		
		contradicting the differentiability of $ \varphi $ in zero. An analogous argument shows that also $ D^{-}f(0) $ must be empty.
		
		On the other hand, the function $ f - f = \hat{0} $ admits a superdifferential in zero, namely its classical derivative.
		
		The next subsection shows a way to circumvent this problem.
		
	\subsection{A fundamental technique}
	
		 \subimport{doubling_device/}{doubling_motivation}
		 
		 We now want to borrow the idea of theorem \ref{density} to prove the difference function $ w $ a viscosity subsolution of \eqref{diff-PDE}. This involves approximating a given superdifferential of $ w $ at some point, as well as the point itself. Consequently; we require the Hamiltonian to be forgiving for approximation errors. That is, we assume
		 
		 \begin{equation}
		 \tag{H2}
		 \lvert H(t, x, p) - H(t, y, p) \rvert \leq \omega(R, \lvert x - y \rvert (1 + \lvert p \rvert)) \hbox{ for all } \ x, y \in B_R(0) \ ,
		 \label{eqn:H2}
		 \end{equation}
		 
		 where $ \omega : \left[0, \infty \right)^2 \to \left[0, \infty \right) $ describes some modulus of continuity. As assumption \eqref{eqn:H2} 
		 might seem far-fetched, we show in \ref{state hamiltonian}, that the Hamiltonian, related to our control problem, satisfies \eqref{eqn:H2} on account of the Lipschitz-conditions imposed onto the problem parameters (cf. \cite[p.~167]{zhou}). We are finally in a position to adapt theorem \ref{smooth_loc} to the case of viscosity solutions.
		 
		 \subimport{./}{viscosity_loc}
		 
		 We have already invoked, but not yet proved lemma \ref{doubling device}, which is no less important. Therefore, we immediately want to catch up on its proof.
		 
		 \subimport{doubling_device/}{doubling_lemma}
		 
		 This method of \emph{doubling the variables} goes back to Kru\v{z}kov who employed a similar function in \cite{kruvzkov}. It is this technique which also lies at the heart of Lions' and Crandall's uniqueness results for viscosity solutions, first introduced in \cite{lions}. \\
		 
		 We can now simply transfer our global comparison result for classical solutions, namely corollary \ref{Smooth Uniqueness}, to viscosity solutions. Once again, the global comparison result will rely on the local one. Since the local comparison result for viscosity solutions additionally requires assumption  \eqref{eqn:H2}, our global comparison result for viscosity solutions will also list \eqref{eqn:H2} among its prerequisites.
		  
		  \begin{corollary}
		  	Corollary \ref{Smooth Uniqueness} also applies to viscosity sub-and supersolutions, if the Hamiltonian $ H : \left[ 0, T \right] \times \mathbb{R}^{N} \times \mathbb{R}^{N+1} $ is continuous and satisfies \eqref{eqn:H2}.
		  	
		  	\begin{proof}
		  		The proof of corollary \ref{Smooth Uniqueness} only relied on the local comparison of sub-and supersolutions provided by theorem \ref{smooth_loc}. 
		  		
		  		According to theorem \ref{viscosity_loc}, theorem \ref{smooth_loc} still applies in the viscosity sense under the additional assumptions. Consequently, the proof of corollary \ref{Smooth Uniqueness} can be repeated verbatim.
		  	\end{proof}
		  \end{corollary}
		  